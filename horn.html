<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è©¦è´</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è©¦è´</h1>
    <nav>
      <a href="index.html">ğŸ  ãƒ›ã‚¤ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°</a>
      <a href="staff.html">ğŸ‘¥ ã‚¹ã‚¿ãƒƒãƒ•ç´¹ä»‹</a>
      <a href="horn.html">ğŸ”Š ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è©¦è´</a>
    </nav>

    <div id="horn-toolbar">
      <label>éŸ³é‡ <input id="horn-volume" type="range" min="0" max="1" step="0.01" value="0.7"></label>
      <button id="horn-stop" class="btn">â¹ åœæ­¢</button>
    </div>
  </header>

  
<script>
  // ã“ã“ã«ä¸¦ã¹ãŸã„éŸ³ã‚’è¿½åŠ ï¼ˆidã¯ä¸€æ„ã«ï¼‰
  const HORNS = [
    { id: "h01", name: "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", file: "./oudio/stock.m4a", comment: "çŸ­ãé‹­ã„ãƒ“ãƒ¼ãƒ—" },
    // ä¾‹ï¼‰{ id: "h02", name: "ãƒ©ãƒªãƒ¼", file: "./oudio/rally.m4a", comment: "å…ƒæ°—ãªãƒˆãƒ¼ãƒ³" },
    // ä¾‹ï¼‰{ id: "h03", name: "ãƒˆãƒ©ãƒƒã‚¯", file: "./oudio/truck.m4a", comment: "ä½éŸ³ã‚ºãƒ‰ãƒ³" },
  ];

  // å…±æœ‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1å€‹ã ã‘ï¼ˆåŒæ™‚å†ç”Ÿã‚’é˜²ãï¼‰
  const player = new Audio();
  player.preload = "auto";
  player.volume = 0.7;
  let currentId = null;

  const container = document.getElementById("horn-container");
  const volumeEl = document.getElementById("horn-volume");
  const stopBtn  = document.getElementById("horn-stop");

  // æ—¢å­˜ã®éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼†åœæ­¢ãƒœã‚¿ãƒ³ã‚’æ´»ã‹ã™
  if (volumeEl) volumeEl.addEventListener("input", () => { player.volume = Number(volumeEl.value); });
  if (stopBtn)  stopBtn.addEventListener("click", () => { player.pause(); player.currentTime = 0; currentId = null; syncButtons(); });

  function render(){
    container.innerHTML = "";
    HORNS.forEach(h => {
      const card = document.createElement("div");
      card.className = "horn-card";
      card.innerHTML = `
        <h3>${h.name}</h3>
        <p class="horn-comment">${h.comment ?? ""}</p>
        <button class="play-btn" data-id="${h.id}">â–¶ å†ç”Ÿ</button>
      `;
      container.appendChild(card);
    });

    container.querySelectorAll(".play-btn").forEach(btn => {
      btn.addEventListener("click", onPlayClick);
    });
  }

  async function onPlayClick(e){
    const id = e.currentTarget.dataset.id;
    const horn = HORNS.find(x => x.id === id);
    if (!horn) return;

    // åŒã˜ãƒœã‚¿ãƒ³ãªã‚‰åœæ­¢ãƒˆã‚°ãƒ«
    if (currentId === id && !player.paused) {
      player.pause();
      currentId = null;
      return syncButtons();
    }

    try {
      player.src = horn.file;
      player.currentTime = 0;
      await player.play();         // ã‚¯ãƒªãƒƒã‚¯å†…ãªã®ã§è‡ªå‹•å†ç”Ÿåˆ¶é™OK
      currentId = id;
      syncButtons();
    } catch (err) {
      console.error("play() error:", err);
      alert("å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚éŸ³æºãƒ‘ã‚¹ã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    }
  }

  function syncButtons(){
    document.querySelectorAll(".play-btn").forEach(btn => {
      const active = (btn.dataset.id === currentId && !player.paused);
      btn.textContent = active ? "â¸ åœæ­¢" : "â–¶ å†ç”Ÿ";
    });
  }

  player.addEventListener("ended", () => { currentId = null; syncButtons(); });
  player.addEventListener("pause", () => {
    if (player.currentTime === 0) { currentId = null; syncButtons(); }
  });
  player.addEventListener("error", () => {
    console.error("audio error code:", player.error?.code);
    alert("éŸ³æºã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆãƒ‘ã‚¹/ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯/æ‹¡å¼µå­ã‚’ç¢ºèªï¼‰");
  });

  render();
</script>
