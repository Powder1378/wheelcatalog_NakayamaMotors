<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>クラクション試聴</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>クラクション試聴</h1>
    <nav>
      <a href="index.html">🏠 ホイールカタログ</a>
      <a href="staff.html">👥 スタッフ紹介</a>
      <a href="horn.html">🔊 クラクション試聴</a>
    </nav>

    <div id="horn-toolbar">
      <label>音量 <input id="horn-volume" type="range" min="0" max="1" step="0.01" value="0.7"></label>
      <button id="horn-stop" class="btn">⏹ 停止</button>
    </div>
  </header>

  
<main id="horn-container"></main>


<script>
  window.addEventListener('DOMContentLoaded', () => {
    // 1件だけ（まずは表示が出ることを確認）
    const HORNS = [
      { id: "h01", name: "stock", file: "./oudio/stock.m4a", comment: "デフォルト" },
      { id: "h02", name: "truck", file: "./oudio/truck.m4a", comment: "トラックやPD車両" },
      { id: "h03", name: "cop", file: "./oudio/cop.m4a", comment: "ぱふっ" },
      { id: "h04", name: "clown", file: "./oudio/clown.m4a"}, 
      { id: "h05", name: "musical1", file: "./oudio/musical1.m4a"},
      { id: "h06", name: "musical2", file: "./oudio/musical2.m4a"},
      { id: "h07", name: "musical3", file: "./oudio/musical3.m4a"},
      { id: "h08", name: "musical4", file: "./oudio/musical4.m4a"},
      { id: "h09", name: "musical5", file: "./oudio/musical5.m4a"},
      { id: "h10", name: "sad", file: "./oudio/sad.m4a", comment: "あおり運転用" },
      { id: "h11", name: "classical1", file: "./oudio/classical1.m4a"},
      { id: "h12", name: "classical2", file: "./oudio/classical2.m4a"},
      { id: "h13", name: "classical3", file: "./oudio/classical3.m4a"},
      { id: "h14", name: "classical4", file: "./oudio/classical4.m4a"},
      { id: "h15", name: "classical5", file: "./oudio/classical5.m4a"},
      { id: "h16", name: "classical6", file: "./oudio/classical6.m4a"},
      { id: "h17", name: "classical7", file: "./oudio/classical7.m4a"},
      { id: "h18", name: "ド", file: "./oudio/do.m4a"},
      { id: "h19", name: "レ", file: "./oudio/re.m4a"},
      { id: "h20", name: "ミ", file: "./oudio/mi.m4a"},
      { id: "h21", name: "ファ", file: "./oudio/fa.m4a"},
      { id: "h22", name: "ソ", file: "./oudio/sol.m4a", comment: "音源準備中" },
      { id: "h23", name: "ラ", file: "./oudio/la.m4a"},
      { id: "h24", name: "シ", file: "./oudio/ti.m4a" },
      { id: "h25", name: "ド", file: "./oudio/do↑.m4a", comment: "高いド" },
      { id: "h26", name: "jazz1", file: "./oudio/jazz1.m4a"},
      { id: "h27", name: "jazz2", file: "./oudio/jazz2.m4a"},
      { id: "h28", name: "jazz3", file: "./oudio/jazz3.m4a"},
      { id: "h29", name: "jazzloop", file: "./oudio/jazzloop.m4a"},
      { id: "h30", name: "star1", file: "./oudio/star1.m4a"},
      { id: "h31", name: "star2", file: "./oudio/star2.m4a"},
      { id: "h32", name: "star3", file: "./oudio/star3.m4a"},
      { id: "h33", name: "star4", file: "./oudio/star4.m4a"},
      { id: "h34", name: "classical8", file: "./oudio/classical8.m4a"},
      { id: "h35", name: "classical9", file: "./oudio/classical9.m4a"},
      { id: "h36", name: "classical10", file: "./oudio/classical10.m4a"},
      { id: "h37", name: "funeral", file: "./oudio/funeral.m4a"},
      { id: "h38", name: "spooky", file: "./oudio/spooky.m4a"},
      { id: "h39", name: "sanandreas", file: "./oudio/sanandreas.m4a"},
      { id: "h40", name: "libertycity", file: "./oudio/libertycity.m4a"},
      { id: "h41", name: "festive1", file: "./oudio/festive1.m4a"},
      { id: "h42", name: "festive2", file: "./oudio/festive2.m4a"},
      { id: "h43", name: "festive3", file: "./oudio/festive3.m4a"},
      { id: "h44", name: "horn53", file: "./oudio/horn53.m4a"},
      { id: "h45", name: "horn55", file: "./oudio/horn55.m4a",
      { id: "h46", name: "horn57", file: "./oudio/horn57.m4a"}
    ];

    const container = document.getElementById("horn-container");
    if (!container) {
      console.error('#horn-container が見つかりません');
      return;
    }

    // 表示
    container.innerHTML = HORNS.map(h => `
      <div class="horn-card" style="border:2px solid #4dd0e1;border-radius:12px;padding:1rem;text-align:center;background:#fff;margin:8px 0">
        <h3 style="margin:.2rem 0;color:#0288d1">${h.name}</h3>
        <p style="margin:0 0 .5rem;color:#555">${h.comment ?? ""}</p>
        <button class="play-btn" data-id="${h.id}" style="background:#0288d1;color:#fff;border:none;padding:.5rem 1rem;border-radius:8px;cursor:pointer">▶ 再生</button>
      </div>
    `).join('');

    // 再生（共有プレイヤー）
    const player = new Audio();
    player.preload = "auto";
    player.volume = 0.7;
    let currentId = null;

    const volumeEl = document.getElementById("horn-volume");
    const stopBtn  = document.getElementById("horn-stop");
    if (volumeEl) volumeEl.addEventListener("input", () => { player.volume = Number(volumeEl.value); });
    if (stopBtn)  stopBtn.addEventListener("click", () => { player.pause(); player.currentTime = 0; currentId = null; syncButtons(); });

    container.querySelectorAll(".play-btn").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        const id = e.currentTarget.dataset.id;
        const horn = HORNS.find(x => x.id === id);
        if (!horn) return;

        if (currentId === id && !player.paused) {
          player.pause();
          currentId = null;
          return syncButtons();
        }

        try {
          player.src = horn.file;          // ← ここが実ファイルパス
          player.currentTime = 0;
          await player.play();             // クリック内なので自動再生制限OK
          currentId = id;
          syncButtons();
        } catch (err) {
          console.error("play() error:", err);
          alert("再生に失敗：パス ./oudio/stock.m4a とブラウザ設定を確認してください。");
        }
      });
    });

    function syncButtons(){
      container.querySelectorAll(".play-btn").forEach(btn => {
        btn.textContent = (btn.dataset.id === currentId && !player.paused) ? "⏸ 停止" : "▶ 再生";
      });
    }

    player.addEventListener("ended", () => { currentId = null; syncButtons(); });
    player.addEventListener("pause", () => {
      if (player.currentTime === 0) { currentId = null; syncButtons(); }
    });
    player.addEventListener("error", () => {
      console.error("audio error code:", player.error?.code);
      alert("音源の読み込みに失敗（パス/拡張子/コーデック）");
    });
  });
</script>
