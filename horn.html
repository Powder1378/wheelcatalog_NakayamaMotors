<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>クラクション試聴</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>クラクション試聴</h1>
    <nav>
      <a href="index.html">🏠 ホイールカタログ</a>
      <a href="staff.html">👥 スタッフ紹介</a>
      <a href="horn.html">🔊 クラクション試聴</a>
    </nav>

    <div id="horn-toolbar">
      <label>音量 <input id="horn-volume" type="range" min="0" max="1" step="0.01" value="0.7"></label>
      <button id="horn-stop" class="btn">⏹ 停止</button>
    </div>
  </header>
<section id="audio-diagnose" style="padding:12px 16px;max-width:900px;margin:12px auto;background:#fff;border:2px solid #4dd0e1;border-radius:10px">
  <h2 style="margin:0 0 .5rem;color:#0288d1;font-size:1.1rem">音源診断</h2>
  <p style="margin:.3rem 0">下のコントロールで鳴るか確認 → 鳴かなければパス/コーデック問題です。</p>
  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <!-- ★ あなたの実ファイル名に合わせて修正！ -->
    <code id="p">./sounds/horn01.m4a</code>
    <button id="diag-play">▶ 再生</button>
    <button id="diag-stop">⏹ 停止</button>
    <a id="diag-open" href="./sounds/horn01.m4a" target="_blank" style="margin-left:auto">ファイルを直接開く</a>
  </div>
  <audio id="diag-a" controls preload="auto" style="width:100%;margin-top:.5rem">
    <source id="s1" src="./sounds/horn01.m4a" type="audio/mp4">
    <source id="s2" src="./sounds/horn01.mp3" type="audio/mpeg">
    このブラウザは audio に対応していません
  </audio>
  <pre id="diag-log" style="background:#f7f7f7;border:1px dashed #ccc;padding:.5rem;white-space:pre-wrap;margin-top:.5rem;max-height:200px;overflow:auto"></pre>
</section>

<script>
(function(){
  const a = document.getElementById('diag-a');
  const log = (m)=>{ const el=document.getElementById('diag-log'); el.textContent += m + "\n"; };
  document.getElementById('diag-play').onclick = async ()=>{
    try{
      a.muted=false; a.volume=0.9; a.currentTime=0;
      await a.play(); log('play(): OK');
    }catch(e){ log('play() エラー: ' + e); alert('ページ内を一度クリックしてから再生してみて下さい'); }
  };
  document.getElementById('diag-stop').onclick = ()=>{ a.pause(); a.currentTime=0; };
  a.addEventListener('error', ()=>{
    const c = a.error && a.error.code;
    log('audio error code=' + c + '（1:ABORT 2:NETWORK 3:DECODE 4:SRC_NOT_SUPPORTED）');
  });
  // ブラウザ対応状況
  log('canPlayType m4a(audio/mp4): ' + a.canPlayType('audio/mp4'));
  log('canPlayType mp3(audio/mpeg): ' + a.canPlayType('audio/mpeg'));
})();
</script>
